<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["shell","python"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
              <a href="#" data-language-name="python">python</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://github.com/NextThingCo/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Welcome to Next Thing Co documentation.</p>

          <h1 id="powering-chip">Powering CHIP</h1>

<p>The single most important thing to using any electronic device is getting electricity to the right places. This tutorial covers how to turn CHIP &ldquo;on&rdquo;. This might seem so straightforward that it doesn&rsquo;t deserve several paragraphs, but CHIP is pretty clever, so there&rsquo;s actually a few things worth knowing.</p>

<h2 id="what-39-s-it-need">What&rsquo;s It Need?</h2>

<p>In general, CHIP is powered by a 5-volt source like a USB port or phone charger, and draws about 300mA peak (at boot time), runs on around 100mA, and rests with around 80mA with the processor totally unloaded. This may be more than you need to know if you just want to plug it in to the wall, but, as you build projects with CHIP, you&rsquo;ll be happy to know there&rsquo;s a lot of ways to get the electricity flowing.</p>

<h2 id="how-do-i-know-chip-is-on">How Do I Know CHIP Is On?</h2>

<p>CHIP is silent. It doesn&rsquo;t take much energy, so it&rsquo;s not very hot. It has no discernible smell. As a result, many of your senses are not great indicators that it is working. There are two LEDs next to the USB micro connector. When CHIP is on, you should see the <code class="prettyprint">PWR</code> LED light up nice and bright.</p>

<h2 id="power-from-the-wall">Power From The Wall</h2>

<p>The CHIP&rsquo;s microUSB connector is used to provide power from most any USB power source. USB wall-wart adapters are probably littered all over your house. If for some reason you don&rsquo;t have one, you can buy one from us or any electronics retailer. Just plug a USB-A-to-microUSB-B cable (that&rsquo;s the same cable most phones, tablets, and whatnot use to charge) into the wall-wart and CHIP, and you&rsquo;ll see the <code class="prettyprint">PWR</code>LED light up (forgive the underexposure, but you can see a small pink LED under the green one, and FWIW, LED colors may be different on your CHIP!).</p>

<p><img alt="CHIP indicator LEDs" src="images/wiki:chip_ledon.jpg?400" /></p>

<h2 id="power-from-a-battery">Power From a Battery</h2>

<p>CHIP can also be battery powered. Specifically, any single cell (1S) 3.7V Lithium Polymer (LiPo) battery with a 2-pin JST-PH 2.0mm end can be connected to the JST-PH socket.</p>

<p><img alt="CHIP powered by a battery. Slick!" src="images/wiki:chip_battery.jpg?400" /></p>

<p>The JST can only plug it in one way, so if you are having a hard time lining things up, turn it around! Needless to say, do not force the battery connector into the socket if something doesn&rsquo;t feel right!</p>

<p>What&rsquo;s really great is that if you plug in to a charger and plug in a battery, the battery will charge - all the power management is on CHIP itself. Roughly, it takes about four to six hours to charge a 3000mAh LiPo battery from a 5V 1A power source. Also, our delightful little Power Management IC, the AXP209, handles pass-through power, so while on and charging a battery, C.H.I.P. is basically running on a uninterruped power supply &ndash; If charge power fails, C.H.I.P. seamlessly switches onto battery power without shutting off.</p>

<h2 id="more-battery-details">More Battery Details</h2>

<p>Besides the JST connector, you can connect a battery to header U13, pin 8 for BAT+, and U13 pin 4 for Ground (or any GND, really).</p>

<p>Some LiPo batteries have three wire connectors. The third (usually yellow) wire is a temperature sensor that helps regulate battery charging. That can be connected to U13, pin 6.</p>

<p>There are some battery-specific configurations accessible through the AXP209 PMIC. For very advanced users, you may want to tweak charge rates, completion voltages, temperature sensor type, and whatnot to match the battery you select for your C.H.I.P.</p>

<p><img alt="Pinout diagram for CHIP" src="images/wiki:chip_alpha_v02_pinouts.png?500" /></p>

<h2 id="power-from-some-other-power-source">Power From Some Other Power Source</h2>

<p>Electricity can be generated in a lot of ways, so if you can make +5V (up to 6.5V is ok) happen with enough current†, CHIP makes it easy to use. Just plug your +5 V and ground into header U13 pins 2 (Charge Input) and 4 (Ground) respectively and bask in the glow of the <code class="prettyprint">PWR</code> LED indicating power.</p>

<p>†: <em>minimum useful current depends on what you have your C.H.I.P. doing, but at least 500mA is a good place to start, and then add for any additional draw from attached USB devices.</em></p>

<h2 id="power-limitations">Power Limitations</h2>

<p>The USB micro connector only provides up to 500mA by default.
The CHG-IN connections on U13.2 can take +5V up to +6.5V.</p>

<h2 id="power-up-and-power-down">Power Up and Power Down</h2>

<p>When you connect a power source, CHIP will boot up. If CHIP is shutdown, but connected to power, you can hold the tiny button for about one second to boot.
If you want to power down, there&rsquo;s a few ways to do this.</p>

<p>• Use software to shutdown (or restart).
The best way to power down is to use the terminal command</p>
<pre class="highlight shell"><code>  poweroff
</code></pre>

<p>This ensures that the memory will be best protected.</p>

<p>• Unplug the USB micro cable and/or battery, or whatever power source you&rsquo;re using.
This works, though it may cause memory instability over time.memory won&rsquo;t get corrupted.</p>

<p>• Use the tiny button.
CHIP has a small button that you can hold for 10 seconds, which will turn CHIP off.</p>

<p>• Use <em>your own</em> button.
U13, pin 10 can be used to connect a switch of your choice which can turn CHIP on or off when shorted to GND. The behavior is the same as the onboard tiny button.</p>

<h2 id="user-configurable-power-management">User Configurable Power Management.</h2>

<p>Because CHIP is highly configurable and the scope of this document is topical, it is sufficient to say that there are several ways to adjust power management using the power of programming, so if you don&rsquo;t like what you read so far, you can probably change it.</p>

<h2 id="board-labels-acin-5v-vs-charge-in">Board Labels: ACIN-5V vs CHARGE-IN</h2>

<p>These are exactly the same thing. A great debate was had (inside Gus&rsquo; head) about whether it would be less confusing for folks to stick with ACIN, which is the pin naming used on the AXP209, or use a reasonable name that makes sense for the actual function of the pin. If you see &ldquo;ACIN&rdquo; anywhere, don&rsquo;t worry, it&rsquo;s not AC. Don&rsquo;t plug it into a wall. Don&rsquo;t go buy a 5VAC transformer. Just pretend it says what it should: CHARGE-IN.</p>

          <h1 id="c-h-i-p-and-composite-video">C.H.I.P. and Composite Video</h1>

<p>C.H.I.P. comes with a 1/8&quot; (3.5mm) Tip-Ring-Ring-Sleeve (TRRS) jack, capable of carrying stereo audio, and either composite video out, or microphone in.</p>

<p><img alt="Typical AV cable that carries stereo audio and composite video" src="images/wiki:avcable.jpg?400" /></p>

<p>This is a fairly common port, but there are a few different arrangements of the conductors, so not all cables are equal.  Fortunately, C.H.I.P. uses the same conductor arrangement as Pi, Zune, and iPod audio/video cables, so the most common &ldquo;mini to RCA A/V&rdquo; cables should work just fine.</p>

<p>Some cables will route signals a bit differently, using the Red RCA cable for Video instead of Yellow.  If video out isn&rsquo;t working through the yellow cable, see if red works.  If not, your cable may be a version that&rsquo;s arranged in a way that it just won&rsquo;t work with C.H.I.P.</p>

<p>C.H.I.P.s (except the very first shipment of Alpha C.H.I.P.s) ship with cables confirmed to work using this arrangement:</p>

<ul>
<li>yellow : video</li>
<li>red : stereo audio right channel</li>
<li>white : stereo audio left channel</li>
</ul>

<p>The conductors on the TRRS plug are arranged like this:</p>

<p><img alt="Tip: Audio Left, Ring: Audio Right, Ring: Ground, Sleeve: Video" src="images/wiki:trrs_annotated.png?500" /></p>

<p><a href="http://wiki.robotz.com/index.php/TRRS_Phono_Plug">This page</a> has even more details about TRRS plugs.</p>

          <h1 id="installing-c-h-i-p-sdk">Installing C.H.I.P. SDK</h1>

<p>CHIP-SDK has everything needed to develop software for C.H.I.P. Most importantly, if you want to load an operating system onto CHIP, the only supported way is to do this from a virtual machine. Given that the virtual machine runs Ubuntu, it&rsquo;s pretty safe to say that Ubuntu users can flash without the virtual machine.</p>

<h2 id="requirements">Requirements</h2>

<ul>
<li>Computer running OS X 10.10+, Ubuntu 14.04+, or Windows 7+</li>
<li>At least 1 GB free RAM, up to 40 GB of disk space may be used</li>
<li>Software: VirtualBox, Vagrant, git, terminal</li>
</ul>

<h2 id="software-setup">Software Setup</h2>

<p>There are several required software pieces to get the CHIP SDK virtual machine running. Follow the instructions to get it all setup.</p>

<h3 id="install-virtualbox-and-extensions">Install VirtualBox and Extensions</h3>

<ul>
<li>Get the installer for <a href="https://www.virtualbox.org/wiki/Downloads">Virtual Box</a></li>
<li>Install the Oracle VM VirtualBox <a href="https://www.virtualbox.org/wiki/Downloads">Extension Pack</a>.</li>
<li>If you are using Windows, you need to add the VirtualBox installation directory to your PATH.</li>
<li>In case of a Ubuntu host: add your user to the vboxusers group!</li>
</ul>

<h3 id="install-vagrant">Install Vagrant</h3>

<p>Install Vagrant from the <a href="https://www.vagrantup.com/downloads.html">Vagrant site.</a>
Alternatively, if OS X, you can use the <a href="http://brew.sh/">homebrew</a> package manager:
brew install caskroom/cask/brew-cask
brew cask install vagrant</p>

<h3 id="install-git">Install Git</h3>

<p>Installation of Git depends on your operating system:</p>

<ul>
<li>Windows: <a href="https://git-scm.com/download/win">direct to download</a></li>
<li>Debian Linux: <code class="prettyprint">sudo apt-get install git</code></li>
<li>OS X homebrew: <code class="prettyprint">brew install git</code></li>
</ul>

<h2 id="clone-the-chip-sdk-repository-and-boot-the-virtual-machine">Clone the CHIP-SDK repository and boot the Virtual Machine</h2>

<p>Assuming you have <a href="http://www.chambaud.com/2013/07/08/adding-git-to-path-when-using-github-for-windows/">git in your PATH</a>, open up a terminal and type:</p>
<pre class="highlight shell"><code>git clone https://github.com/NextThingCo/CHIP-SDK
</code></pre>

<p>and start up the virtual machine:</p>
<pre class="highlight shell"><code><span class="nb">cd </span>CHIP-SDK
vagrant up
</code></pre>

<h2 id="login-to-virtual-machine">Login To Virtual Machine</h2>

<p>In the same shell on the host type the following:</p>
<pre class="highlight shell"><code> vagrant ssh
</code></pre>

<p>If everything went well you should see the following prompt:</p>
<pre class="highlight shell"><code>vagrant@vagrant-ubuntu-trusty-32:~<span class="err">$</span>
</code></pre>

<p>Congratulations!Now you&rsquo;re ready to Flash a C.H.I.P. from your SDK!</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>Here are a few possible problems.</p>

<h3 id="shared-folder-out-of-sync">Shared Folder Out of Sync</h3>

<p>In case you run into trouble because the kernel in the VM was updated and the shared vagrant folder can no longer be mounted, update the guest additions by typing the following in the CHIP-SDK directory on the host:</p>
<pre class="highlight shell"><code>vagrant plugin install vagrant-vbguest
</code></pre>

<p>This <a href="http://kvz.io/blog/2013/01/16/vagrant-tip-keep-virtualbox-guest-additions-in-sync/">blog post</a> has some more tips on keeping additions in sync.</p>

<h3 id="invalid-state">Invalid State</h3>

<p>If you get an error like:</p>
<pre class="highlight shell"><code>error: The guest machine entered an invalid state <span class="k">while </span>waiting <span class="k">for </span>it to boot.
</code></pre>

<p>This probably means your version of VirtualBox needs updating and/or needs the Extension Pack. Update as necessary and try <code class="prettyprint">vagrant up</code> again.</p>

<h3 id="couldn-39-t-find-file">Couldn&rsquo;t Find File</h3>

<p>If you get the error:</p>
<pre class="highlight shell"><code>error: Couldn<span class="s1">'t open file /Volumes/Satellite/gitbins/CHIP-SDK/base
</span></code></pre>

<p>that means you didn&rsquo;t cd CHIP-SDK. Very basic, perhaps, but late nights sometimes need that bump!</p>

          <h1 id="updating-the-chip-sdk-virtual-machine">Updating the CHIP-SDK Virtual Machine</h1>

<p>You may have been working with CHIP for a while now, and you want to updated your SDK. It&rsquo;s only slightly more involved than sync&#39;ing with the git repo; you have to update the virtual machine, too.</p>

<h2 id="requirements">Requirements</h2>

<ul>
<li>Computer running OS X 10.10+, Ubuntu 14.04+, or Windows 7+</li>
<li>Existing <a href="Install CHIP SDK - minimal">installation of CHIP-SDK</a></li>
</ul>

<h2 id="how-to-update">How To Update</h2>

<p>Just follow these steps:</p>

<p>On your host operating system, pull the latest changes from our Git repository:</p>
<pre class="highlight shell"><code>  <span class="nb">cd</span> ~/CHIP-SDK
  git pull
</code></pre>

<p>Make sure the virtual machine is shut down and update it:</p>
<pre class="highlight shell"><code>  vagrant halt
  vagrant provision
</code></pre>

<p>Now you can boot the virtual machine and ssh into it:</p>
<pre class="highlight shell"><code>  vagrant up
  vagrant ssh
</code></pre>

<p>Once you see the trusty prompt, your CHIP SDK virtual machine is ready to use:</p>
<pre class="highlight shell"><code>  vagrant@vagrant-ubuntu-trusty-32:~<span class="err">$</span>
</code></pre>

          <h1 id="flash-chip-with-firmware-from-sdk">Flash CHIP With Firmware from SDK</h1>

<p>Before you begin, follow the tutorial to <a href="Install CHIP SDK - minimal">install the CHIP-SDK</a>. If you have already installed the SDK, you may need to <a href="Update CHIP SDK - minimal">update the virtual machine</a>. Now you&rsquo;re ready to launch the virtual machine and give CHIP some firmware and operating system.</p>

<h2 id="requirements">Requirements</h2>

<ul>
<li>Computer running OS X 10.10+, Ubuntu 14.04+, or Windows 7+</li>
<li>CHIP</li>
<li>Jumper wire</li>
<li>Internet connection</li>
<li>Software: terminal, VirtualBox, Vagrant, git</li>
</ul>

<h2 id="boot-virtual-machine">Boot Virtual Machine</h2>

<p>On the host machine, open a terminal and</p>
<pre class="highlight shell"><code>  <span class="nb">cd </span>CHIP-SDK
  vagrant up
  vagrant ssh
</code></pre>

<p>This opens a virtual machine running Ubuntu Linux, and you&rsquo;ll get this prompt in your Terminal:</p>
<pre class="highlight shell"><code>  vagrant@vagrant-ubuntu-trusty-32:~<span class="err">$</span>
</code></pre>

<p>If you have previously installed the CHIP-SDK, you may need to update from within the virtual machine. If this is the first SDK install, <a href="##Flash With NTC Buildroot OS">move on to flashing</a>):</p>
<pre class="highlight shell"><code>  <span class="nb">cd</span> ~/
  sudo rm -r ~/sunxi-tools
  git clone https://github.com/NextThingCo/sunxi-tools.git
  <span class="nb">cd </span>sunxi-tools
  make
  sudo ln -s <span class="nv">$PWD</span>/fel /usr/local/bin/fel
  <span class="nb">cd</span> ~/CHIP-tools
  git pull https://github.com/NextThingCo/CHIP-tools.git
  <span class="nb">cd</span> ~/CHIP-SDK
  git pull https://github.com/NextThingCo/CHIP-SDK.git
</code></pre>

<h2 id="flash-with-firmware">Flash With Firmware</h2>

<p>Now that the virtual machine is running and configured, you can connect CHIP to your computer and give it an operating system.</p>

<h3 id="prepare-chip-for-flashing">Prepare CHIP for Flashing</h3>

<p>Prepare CHIP with a jumper wire connecting Pin 7 and Pin 39 on header U14 (UBOOT pin and GND). Here&rsquo;s a reference image that labels the headers and pins:</p>

<p><img alt="CHIP with jumper wire attatched" src="images/wiki:uboot_jumper.jpg?400" /></p>

<p><em>Note: this jumper needs to be present only when you connect CHIP to power</em>. If for some reason the wire becomes disconnected after you have powered CHIP, there is no problem or need to panic.</p>

<p>Now connect CHIP to your computer with a <a href="https://commons.wikimedia.org/wiki/File:Micro_USB.jpg">micro-USB</a>-&gt;USB-B cable. The power LED will illuminate.</p>

<h3 id="option-1-flash-with-ntc-buildroot-os">Option 1: Flash With NTC Buildroot OS</h3>

<p>Buildroot is a lean operating system, and does not have a package manager to install software. You can add additional software before you flash CHIP by [[##Customize buildroot|customizing buildroot]]. To flash CHIP with the buildroot OS:</p>
<pre class="highlight shell"><code>  <span class="nb">cd</span> ~/CHIP-tools
  ./chip-update-firmware.sh
</code></pre>

<p>During flashing, the terminal will fill with messages.  If successful, you&rsquo;ll see C.H.I.P. run through a hardware test, with the answers being &lsquo;OK&rsquo;.  If C.H.I.P. is &#39;OK&rsquo;, you can remove the jumper wire. Here is a <a href="##Buildroot Output">sample successful output</a>.</p>

<h3 id="option-2-flash-with-debian">Option 2: Flash With Debian</h3>

<p>If you want to flash CHIP with the debian OS</p>
<pre class="highlight shell"><code>  <span class="nb">cd</span> ~/CHIP-tools
  ./chip-update-firmware.sh -d
</code></pre>

<p>During flashing, the terminal will fill with messages. If successful, you&rsquo;ll see C.H.I.P. run through a hardware test, with the answers being &#39;OK&rsquo;.  If C.H.I.P. is &#39;OK&rsquo;, you can remove the jumper wire. Here is a <a href="##Debian Output">sample successful output</a>.</p>

<h3 id="connect-to-chip-and-do-something">Connect to CHIP and Do Something</h3>

<p>After a few minutes, you&rsquo;ll be able to connect to CHIP via serial:</p>
<pre class="highlight shell"><code>  cu -l /dev/ttyACM0 -s 115200
</code></pre>

<p>and even test the hardware:</p>
<pre class="highlight shell"><code>  hwtest
</code></pre>

<h3 id="customize-buildroot">Customize buildroot</h3>

<p>If you want to customize buildroot, use these commands before you run the <code class="prettyprint">./chip-update-firmware.sh</code> script to flash CHIP with firmware:</p>
<pre class="highlight shell"><code>  <span class="nb">cd</span> ~/CHIP-buildroot
  make chip_defconfig
  make nconfig
</code></pre>

<p>The <code class="prettyprint">nconfig</code> command will display a text interface in your terminal. Use your arrow keys to browse and select additional software for the buildroot OS. When you&rsquo;re finished with your selections, exit by hitting the F9 key, which will automatically save your custom buildroot to:</p>
<pre class="highlight shell"><code>  /home/vagrant/CHIP-buildroot/.config
</code></pre>

<p>Now let&rsquo;s build your buildroot with your custom additions:
  make
This will take a while, maybe an hour. When finished, flash CHIP with the script:</p>
<pre class="highlight shell"><code>  <span class="nb">cd</span> ~/CHIP-tools
  ./chip-update-firmware.sh
</code></pre>

<hr>

<hr>

<h2 id="appendix">Appendix</h2>

<p>Some additional info and examples.</p>

<h3 id="buildroot-output">Buildroot Output</h3>

<p>Sample output from flashing Buildroot to CHIP looks like:</p>
<pre class="highlight shell"><code><span class="nv">ROOTFS_URL</span><span class="o">=</span>http://opensource.nextthing.co.s3.amazonaws.com/chip/buildroot/stable/71/images
<span class="nv">BUILD</span><span class="o">=</span>71
<span class="nv">BR_URL</span><span class="o">=</span>http://opensource.nextthing.co.s3.amazonaws.com/chip/buildroot/stable/71/images
<span class="nv">BR_BUILD</span><span class="o">=</span>71
/home/doge/gits/CHIP-tools/.firmware/images/rootfs.ubi exists... comparing to http://opensource.nextthing.co.s3.amazonaws.com/chip/buildroot/stable/71/images/rootfs.ubi
MD5: 90315ca1fb8ff95fc6878ce8126bdf02
S3_MD5: 6d59af4a0f673e1d61147e4a06dd7ba8
md5sum differs
--2015-10-21 15:59:16--  http://opensource.nextthing.co.s3.amazonaws.com/chip/buildroot/stable/71/images/rootfs.ubi
Resolving opensource.nextthing.co.s3.amazonaws.com <span class="o">(</span>opensource.nextthing.co.s3.amazonaws.com<span class="o">)</span>... 54.231.176.13
Connecting to opensource.nextthing.co.s3.amazonaws.com <span class="o">(</span>opensource.nextthing.co.s3.amazonaws.com<span class="o">)</span>|54.231.176.13|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 54525952 <span class="o">(</span>52M<span class="o">)</span> <span class="o">[</span>binary/octet-stream]
Saving to: ‘/home/doge/gits/CHIP-tools/.firmware/images/rootfs.ubi’

100%[<span class="o">======================================</span>&gt;] 54,525,952  1.83MB/s   <span class="k">in </span>29s    

2015-10-21 15:59:45 <span class="o">(</span>1.82 MB/s<span class="o">)</span> - ‘/home/doge/gits/CHIP-tools/.firmware/images/rootfs.ubi’ saved <span class="o">[</span>54525952/54525952]

/home/doge/gits/CHIP-tools/.firmware/images/sun5i-r8-chip.dtb exists... comparing to http://opensource.nextthing.co.s3.amazonaws.com/chip/buildroot/stable/71/images/sun5i-r8-chip.dtb
MD5: de0beb674eeb382901251febfbf1cf9b
S3_MD5: de0beb674eeb382901251febfbf1cf9b
file already downloaded
/home/doge/gits/CHIP-tools/.firmware/images/sunxi-spl.bin exists... comparing to http://opensource.nextthing.co.s3.amazonaws.com/chip/buildroot/stable/71/images/sunxi-spl.bin
MD5: dd3f9c9c0984a6c1d7cdca2921f6f448
S3_MD5: dd3f9c9c0984a6c1d7cdca2921f6f448
file already downloaded
/home/doge/gits/CHIP-tools/.firmware/images/uboot-env.bin exists... comparing to http://opensource.nextthing.co.s3.amazonaws.com/chip/buildroot/stable/71/images/uboot-env.bin
MD5: 6f2b79a781f9f490911012ec3aa653e9
S3_MD5: 6f2b79a781f9f490911012ec3aa653e9
file already downloaded
/home/doge/gits/CHIP-tools/.firmware/images/zImage exists... comparing to http://opensource.nextthing.co.s3.amazonaws.com/chip/buildroot/stable/71/images/zImage
MD5: 0d35ad764564a2cee9281715823597a2
S3_MD5: 0d35ad764564a2cee9281715823597a2
file already downloaded
/home/doge/gits/CHIP-tools/.firmware/images/u-boot-dtb.bin exists... comparing to http://opensource.nextthing.co.s3.amazonaws.com/chip/buildroot/stable/71/images/u-boot-dtb.bin
MD5: 97340d221bcbcc8f0bf27e26adc26f0a
S3_MD5: 97340d221bcbcc8f0bf27e26adc26f0a
file already downloaded
BUILDROOT_OUTPUT_DIR <span class="o">=</span> /home/doge/gits/CHIP-tools/.firmware
<span class="o">==</span> preparing images <span class="o">==</span>
/home/doge/gits/CHIP-tools/spl-image-builder -d -r 3 -u 4096 -o 1664 -p 16384 -c 1024 -s 64 /home/doge/gits/CHIP-tools/.firmware/images/sunxi-spl.bin /tmp/chipflashqVYEIs/sunxi-padded-spl
<span class="nv">filesize</span><span class="o">=</span> 3573504
<span class="nv">PADDED_SPL_SIZE</span><span class="o">=</span>0x000000c6
35+1 records <span class="k">in
</span>36+0 records out
589824 bytes <span class="o">(</span>590 kB<span class="o">)</span> copied, 0.00082507 s, 715 MB/s
12+0 records <span class="k">in
</span>12+0 records out
196608 bytes <span class="o">(</span>197 kB<span class="o">)</span> copied, 0.0176519 s, 11.1 MB/s
Image Name:   flash CHIP
Created:      Wed Oct 21 15:59:46 2015
Image Type:   ARM Linux Script <span class="o">(</span>uncompressed<span class="o">)</span>
Data Size:    736 Bytes <span class="o">=</span> 0.72 kB <span class="o">=</span> 0.00 MB
Load Address: 00000000
Entry Point:  00000000
Contents:
   Image 0: 728 Bytes <span class="o">=</span> 0.71 kB <span class="o">=</span> 0.00 MB
<span class="o">==</span> upload the SPL to SRAM and execute it <span class="o">==</span>
waiting <span class="k">for </span>fel...OK
<span class="o">==</span> upload spl <span class="o">==</span>
<span class="o">==</span> upload u-boot <span class="o">==</span>
<span class="o">==</span> upload u-boot script <span class="o">==</span>
<span class="o">==</span> upload ubi <span class="o">==</span>
<span class="gp">100% </span><span class="o">[============================================================]</span>
<span class="o">==</span> execute the main u-boot binary <span class="o">==</span>
<span class="o">==</span> write ubi <span class="o">==</span>
flashing................OK
login... OK
password... OK
poweroff... OK
</code></pre>

<h3 id="debian-output">Debian Output</h3>

<p>Sample output from a successful Debian output:</p>
<pre class="highlight shell"><code>debian selected
<span class="nv">ROOTFS_URL</span><span class="o">=</span>http://opensource.nextthing.co.s3.amazonaws.com/chip/debian/stable/37
<span class="nv">BUILD</span><span class="o">=</span>37
<span class="nv">BR_URL</span><span class="o">=</span>http://opensource.nextthing.co/chip/buildroot/stable/71/images
<span class="nv">BR_BUILD</span><span class="o">=</span>71
/home/doge/gits/CHIP-tools/.firmware/images/rootfs.ubi exists... comparing to http://opensource.nextthing.co.s3.amazonaws.com/chip/debian/stable/37/rootfs.ubi
MD5: 6d59af4a0f673e1d61147e4a06dd7ba8
S3_MD5: 90315ca1fb8ff95fc6878ce8126bdf02
md5sum differs
--2015-10-21 16:06:36--  http://opensource.nextthing.co.s3.amazonaws.com/chip/debian/stable/37/rootfs.ubi
Resolving opensource.nextthing.co.s3.amazonaws.com <span class="o">(</span>opensource.nextthing.co.s3.amazonaws.com<span class="o">)</span>... 54.231.160.10
Connecting to opensource.nextthing.co.s3.amazonaws.com <span class="o">(</span>opensource.nextthing.co.s3.amazonaws.com<span class="o">)</span>|54.231.160.10|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 245366784 <span class="o">(</span>234M<span class="o">)</span> <span class="o">[</span>binary/octet-stream]
Saving to: ‘/home/doge/gits/CHIP-tools/.firmware/images/rootfs.ubi’

100%[<span class="o">======================================</span>&gt;] 245,366,784 1.27MB/s   <span class="k">in </span>2m 11s 

2015-10-21 16:08:48 <span class="o">(</span>1.78 MB/s<span class="o">)</span> - ‘/home/doge/gits/CHIP-tools/.firmware/images/rootfs.ubi’ saved <span class="o">[</span>245366784/245366784]

/home/doge/gits/CHIP-tools/.firmware/images/sun5i-r8-chip.dtb exists... comparing to http://opensource.nextthing.co/chip/buildroot/stable/71/images/sun5i-r8-chip.dtb
MD5: de0beb674eeb382901251febfbf1cf9b
S3_MD5: de0beb674eeb382901251febfbf1cf9b
file already downloaded
/home/doge/gits/CHIP-tools/.firmware/images/sunxi-spl.bin exists... comparing to http://opensource.nextthing.co/chip/buildroot/stable/71/images/sunxi-spl.bin
MD5: dd3f9c9c0984a6c1d7cdca2921f6f448
S3_MD5: dd3f9c9c0984a6c1d7cdca2921f6f448
file already downloaded
/home/doge/gits/CHIP-tools/.firmware/images/uboot-env.bin exists... comparing to http://opensource.nextthing.co/chip/buildroot/stable/71/images/uboot-env.bin
MD5: 6f2b79a781f9f490911012ec3aa653e9
S3_MD5: 6f2b79a781f9f490911012ec3aa653e9
file already downloaded
/home/doge/gits/CHIP-tools/.firmware/images/zImage exists... comparing to http://opensource.nextthing.co/chip/buildroot/stable/71/images/zImage
MD5: 0d35ad764564a2cee9281715823597a2
S3_MD5: 0d35ad764564a2cee9281715823597a2
file already downloaded
/home/doge/gits/CHIP-tools/.firmware/images/u-boot-dtb.bin exists... comparing to http://opensource.nextthing.co/chip/buildroot/stable/71/images/u-boot-dtb.bin
MD5: 97340d221bcbcc8f0bf27e26adc26f0a
S3_MD5: 97340d221bcbcc8f0bf27e26adc26f0a
file already downloaded
BUILDROOT_OUTPUT_DIR <span class="o">=</span> /home/doge/gits/CHIP-tools/.firmware
<span class="o">==</span> preparing images <span class="o">==</span>
/home/doge/gits/CHIP-tools/spl-image-builder -d -r 3 -u 4096 -o 1664 -p 16384 -c 1024 -s 64 /home/doge/gits/CHIP-tools/.firmware/images/sunxi-spl.bin /tmp/chipflashUooSfo/sunxi-padded-spl
<span class="nv">filesize</span><span class="o">=</span> 3573504
<span class="nv">PADDED_SPL_SIZE</span><span class="o">=</span>0x000000c6
35+1 records <span class="k">in
</span>36+0 records out
589824 bytes <span class="o">(</span>590 kB<span class="o">)</span> copied, 0.00181383 s, 325 MB/s
12+0 records <span class="k">in
</span>12+0 records out
196608 bytes <span class="o">(</span>197 kB<span class="o">)</span> copied, 0.0164913 s, 11.9 MB/s
Image Name:   flash CHIP
Created:      Wed Oct 21 16:08:49 2015
Image Type:   ARM Linux Script <span class="o">(</span>uncompressed<span class="o">)</span>
Data Size:    736 Bytes <span class="o">=</span> 0.72 kB <span class="o">=</span> 0.00 MB
Load Address: 00000000
Entry Point:  00000000
Contents:
   Image 0: 728 Bytes <span class="o">=</span> 0.71 kB <span class="o">=</span> 0.00 MB
<span class="o">==</span> upload the SPL to SRAM and execute it <span class="o">==</span>
waiting <span class="k">for </span>fel...OK
<span class="o">==</span> upload spl <span class="o">==</span>
<span class="o">==</span> upload u-boot <span class="o">==</span>
<span class="o">==</span> upload u-boot script <span class="o">==</span>
<span class="o">==</span> upload ubi <span class="o">==</span>
<span class="gp">100% </span><span class="o">[============================================================]</span>
<span class="o">==</span> execute the main u-boot binary <span class="o">==</span>
<span class="o">==</span> write ubi <span class="o">==</span>
flashing...........................OK
login... OK
password... OK
poweroff... OK
</code></pre>

<h3 id="failure">Failure</h3>

<p>Here&rsquo;s a couple common errors:</p>
<pre class="highlight shell"><code><span class="o">==</span> upload the SPL to SRAM and execute it <span class="o">==</span>
ERROR: Allwinner USB FEL device not found!
<span class="o">==</span> upload images <span class="o">==</span>
ERROR: Allwinner USB FEL device not found!
ERROR: Allwinner USB FEL device not found!
ERROR: Allwinner USB FEL device not found!
ERROR: Allwinner USB FEL device not found!
<span class="o">==</span> execute the main u-boot binary <span class="o">==</span>
ERROR: Allwinner USB FEL device not found!
</code></pre>

<p>This indicates that CHIP is probably booted into Linux, and not ready to receive firmware. There are three possible reasons for this:
  - You already successfully flashed CHIP, and haven&rsquo;t disconnected the USB cable from your computer.
  - The jumper wire between Pins 7 &amp; 39 is either not present, loose, or the jumper is in the wrong holes.
  - There is a problem with the USB cable.</p>
<pre class="highlight shell"><code>Image 0: 848 Bytes <span class="o">=</span> 0.83 kB <span class="o">=</span> 0.00 MB
<span class="o">==</span> upload the SPL to SRAM and execute it <span class="o">==</span>
ERROR: You don<span class="s1">'t have permission to access Allwinner USB FEL device
== upload images ==
ERROR: You don'</span>t have permission to access Allwinner USB FEL device
ERROR: You don<span class="s1">'t have permission to access Allwinner USB FEL device
ERROR: You don'</span>t have permission to access Allwinner USB FEL device
ERROR: You don<span class="s1">'t have permission to access Allwinner USB FEL device
== execute the main u-boot binary ==
ERROR: You don'</span>t have permission to access Allwinner USB FEL device
</code></pre>

<p>This error means that you need to run the <strong>chip-update-firmware.sh</strong> script with <strong>sudo</strong> (or you need to add a rules file as described below).</p>

<h3 id="optional-convenience">Optional Convenience</h3>

<p>As a developer, there&rsquo;s a good chance you&rsquo;ll flash CHIP more than once in your life. You&rsquo;ll probably want to follow these steps.
In order to be able to run the <strong>chip-update-firmware.sh</strong> script without sudo, make a rules file:</p>
<pre class="highlight shell"><code>sudo touch /etc/udev/rules.d/99-allwinner.rules
</code></pre>

<p>and add the content with the tee command:</p>
<pre class="highlight shell"><code><span class="nb">echo</span> <span class="s1">'SUBSYSTEM=="usb", ATTRS{idVendor}=="1f3a", ATTRS{idProduct}=="efe8", GROUP="plugdev", MODE="0660" SYMLINK+="usb-chip"'</span> | sudo tee /etc/udev/rules.d/99-allwinner.rules
</code></pre>

<p>then, to make this rules file work:
<code class="prettyprint">shell
  sudo udevadm control --reload-rules
</code></p>

          <h1 id="flash-chip-from-ubuntu">Flash CHIP from Ubuntu</h1>

<p>If you are running Ubuntu OS on your computer, and don&rsquo;t want to bother with a virtual machine, you can flash CHIP from your real computer.</p>

<h2 id="requirements">Requirements</h2>

<ul>
<li>Computer running Ubuntu 14.04+</li>
<li>Jumper wire</li>
<li>CHIP</li>
</ul>

<h2 id="install-dependencies">Install Dependencies</h2>

<p>Install some tools:</p>
<pre class="highlight shell"><code>sudo apt-get update
sudo apt-get install u-boot-tools android-tools-fastboot git build-essential libusb-1.0-0-dev
</code></pre>

<p>If you intend to customize buildroot with additional software, install these packages:
  apt-get install libncurses5-dev libc6-i386 lib32stdc++6 lib32z1 android-tools-fsutils
Get and make the fel tools:</p>
<pre class="highlight shell"><code>git clone http://github.com/NextThingCo/sunxi-tools
<span class="nb">cd </span>sunxi-tools
make
sudo rm -f /usr/local/bin/fel
sudo ln -s <span class="nv">$PWD</span>/fel /usr/local/bin/fel
</code></pre>

<p>Clone the CHIP-tools repository</p>
<pre class="highlight shell"><code><span class="nb">cd</span> .. 
git clone http://github.com/NextThingCo/CHIP-tools 
<span class="nb">cd </span>CHIP-tools
</code></pre>

<p>If you have already cloned the CHIP-tools from a previous CHIP flashing, you can, of course, just update your existing repository</p>
<pre class="highlight shell"><code><span class="nb">cd </span>CHIP-tools
git pull http://github.com/NextThingCo/CHIP-tools
</code></pre>

<p>Now you are ready to <a href="flash_chip_from_sdk_-_minimal#Flash With NTC Buildroot OS">flash CHIP</a> with firmware.</p>

          <h1 id="install-x-windows">Install X-windows</h1>

<p>If you want a windowed desktop on C.H.I.P., you can install X-Windows. </p>

<h2 id="requirements">Requirements</h2>

<ul>
<li>CHIP <a href="Connect To A Wireless Network with nmcli">connected to WiFi</a></li>
<li>Monitor attached to CHIP</li>
<li>Keyboard or <a href="Headless CHIP - ssh and serial">Serial or SSH Connection</a> to CHIP</li>
</ul>

<h2 id="installation-xfce4">Installation (xfce4)</h2>

<p>CHIP is a lightweight computer, so we&rsquo;ll install the lightweight xfce4:</p>
<pre class="highlight shell"><code>  apt-get install xfce4
</code></pre>

<p>It might take some time to download and install all the packages, since there are a lot of dependencies and libraries involved. Once installed, start the windowing system with the command</p>
<pre class="highlight shell"><code>  startx&amp;
</code></pre>

<p>(the <code class="prettyprint">&amp;</code> runs Xwindows in the background, so you can still use your terminal). After a minute or so, you&rsquo;ll get an image on the monitor:</p>

<p><img alt="Xwindows up and running on CHIP" src="images/wiki:xwindows_first.png?400" /></p>

<p>Now you can use a mouse and keyboard to explore CHIP and launch programs.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>If you get errors from apt that report &ldquo;unmet dependencies,&rdquo; you can run the command</p>
<pre class="highlight shell"><code>apt-get install -f
</code></pre>

<p>which will force installation of any alternate or missing dependencies of any installed packages.</p>

          <h1 id="connecting-c-h-i-p-to-a-wireless-network-buildroot">Connecting C.H.I.P. to a Wireless Network (buildroot)</h1>

<p>The buildroot operating system uses the <code class="prettyprint">connman</code> command-line network manager to connect and manage your network connections.
If you want all the details of <code class="prettyprint">connman</code> <a href="https://wiki.archlinux.org/index.php/Connman">visit the ArchLinux wiki.</a></p>

<h2 id="requirements">Requirements</h2>

<ul>
<li>CHIP</li>
<li>One of the following:

<ul>
<li>Keyboard and monitor for CHIP</li>
<li><a href="Headless CHIP - ssh and serial">Serial connection</a> to CHIP</li>
</ul></li>
</ul>

<h2 id="step-1-enable-wifi-and-find-a-network">Step 1: Enable WiFi and Find a Network</h2>

<p>First enable WiFi:
  connmanctl enable wifi
then scan for access points:
  connmanctl scan wifi
and see what networks are available:
  connmanctl services
The <code class="prettyprint">services</code> command has output similar to:</p>
<pre class="highlight shell"><code><span class="k">*</span>AO 
    NTC                  wifi_7cc70905cd77_4e5443_managed_psk
                         wifi_7cc70905cd77_hidden_managed_psk
    NTC Guest            wifi_7cc70905cd77_4e5443204775657374_managed_psk
                         wifi_7cc70905cd77_hidden_managed_none
    ATT312               wifi_7cc70905cd77_415454333132_managed_psk
    HP-Print-99-LaserJet 1102 wifi_7cc70905cd77_48502d5072696e742d39392d4c617365724a65742031313032_managed_none
    ATT344               wifi_7cc70905cd77_415454333434_managed_psk
    CBCI-1B57-2.4        wifi_7cc70905cd77_434243492d314235372d322e34_managed_psk
    mi-fi                wifi_7cc70905cd77_6d692d6669_managed_none
    0024A5D8CF33         wifi_7cc70905cd77_303032344135443843463333_managed_psk
    Twirl-Eco-Events-2.4 wifi_7cc70905cd77_547769726c2d45636f2d4576656e74732d322e34_managed_psk
    xfinitywifi          wifi_7cc70905cd77_7866696e69747977696669_managed_none
</code></pre>

<h2 id="step-2-connect-to-an-access-point">Step 2: Connect To An Access Point</h2>

<p>Unfortunately, connman doesn&rsquo;t use the nice name on the left of the services list. It wants the unfriendly string on the right, so you&rsquo;ll want to get copy and paste ready.</p>

<h3 id="a-no-password">A: No Password</h3>

<p>For example, to connect to NTC Guest, which has no password, <code class="prettyprint">services</code> shows two choices. We want the one without “hidden” in the string. Use the connect command to connect:
  connmanctl connect wifi_7cc70905cd77_4e5443204775657374_managed_psk
If your network is not password protected, you&rsquo;ll get some output that will indicate a successful connection, such as:</p>
<pre class="highlight shell"><code><span class="o">[</span>  961.780000] RTL871X: rtw_set_802_11_connect<span class="o">(</span>wlan0<span class="o">)</span>  <span class="nv">fw_state</span><span class="o">=</span>0x00000008
<span class="o">[</span>  962.070000] RTL871X: start auth
<span class="o">[</span>  962.080000] RTL871X: auth success, start assoc
<span class="o">[</span>  962.090000] RTL871X: rtw_cfg80211_indicate_connect<span class="o">(</span>wlan0<span class="o">)</span> BSS not found !!
<span class="o">[</span>  962.100000] RTL871X: assoc success
<span class="o">[</span>  962.110000] RTL871X: send eapol packet
<span class="o">[</span>  962.290000] RTL871X: send eapol packet
<span class="o">[</span>  962.300000] RTL871X: <span class="nb">set </span>pairwise key camid:4, addr:0a:18:d6:97:2d:26, kid:0, <span class="nb">type</span>:AES
<span class="o">[</span>  962.320000] RTL871X: <span class="nb">set </span>group key camid:5, addr:0a:18:d6:97:2d:26, kid:1, <span class="nb">type</span>:AES
</code></pre>

<p>If your network is password protected, you&rsquo;ll get an error.</p>

<h3 id="b-password-protected">B: Password-Protected</h3>

<p>To deal with passwords, you&rsquo;ll need to put <code class="prettyprint">connman</code> into interactive mode:
  connmanctl
which gives a connmanctl prompt:
  connmanctl&gt;
turn the &lsquo;agent&rsquo; on so it can process password requests:
  agent on
and now use the connect command
  connect wifi_7cc70905cd77_4e5443_managed_psk
and enter your password when prompted:
  Agent RequestInput wifi_7cc70905cd77_4e5443_managed_psk
  Passphrase = [ Type=psk, Requirement=mandatory ]
  Passphrase?
Now that you are connected to a wireless network, you can exit connmanctl interactive mode by typing
  quit</p>

<h2 id="step-3-test-connection">Step 3: Test Connection</h2>

<p>In CHIP&rsquo;s command line, you can ping Google four times:
  ping -c 4 8.8.8.8
and expect ping to output some timing messages like:</p>
<pre class="highlight shell"><code>PING 8.8.8.8 <span class="o">(</span>8.8.8.8<span class="o">)</span>: 56 data bytes
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>0 <span class="nv">ttl</span><span class="o">=</span>55 <span class="nb">time</span><span class="o">=</span>209.147 ms
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>55 <span class="nb">time</span><span class="o">=</span>111.125 ms
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>55 <span class="nb">time</span><span class="o">=</span>183.627 ms
64 bytes from 8.8.8.8: <span class="nv">seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>55 <span class="nb">time</span><span class="o">=</span>147.398 ms
--- 8.8.8.8 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max <span class="o">=</span> 111.125/162.824/209.147 ms
</code></pre>

<p>If your connection is not successful, then ping will tell you your network is down:</p>
<pre class="highlight shell"><code>PING 8.8.8.8 <span class="o">(</span>8.8.8.8<span class="o">)</span>: 56 data bytes
ping: sendto: Network is unreachable
</code></pre>

<h3 id="troubleshooting-connection-problems">Troubleshooting Connection Problems</h3>

<ul>
<li>You&rsquo;ll need to make sure you used the right network when you used the connect commnand. </li>
<li>Review any messages that the connect commnand gave you. Did they look like the examples of a successful connection? </li>
<li>If everything checked out until you got to <code class="prettyprint">ping</code>, there&rsquo;s a good chance the problem is with your router or connection to the internet.</li>
</ul>

<h2 id="disconnecting-and-forgetting-networks">Disconnecting And Forgetting Networks</h2>

<p>To disconnect from your network, you might first want a reminder of what unfriendly string is used to describe your access point, so type:
  connmanctl services
which will output information about your current link:</p>
<pre class="highlight shell"><code>  <span class="k">*</span>AO NTC                  wifi_7cc70905cd77_4e5443_managed_psk
</code></pre>

<p>Use the ID to disconnect:
  connmanctl disconnect wifi_7cc70905cd77_4e5443_managed_psk
and you&rsquo;ll get some status like this:</p>
<pre class="highlight shell"><code><span class="o">[</span>  301.890000] RTL871X: clear key <span class="k">for </span>addr:0a:18:d6:97:2d:26, camid:4
<span class="o">[</span>  301.900000] RTL871X: clear key <span class="k">for </span>addr:0a:18:d6:97:2d:26, camid:5
<span class="o">[</span>  301.920000] IPv6: ADDRCONF<span class="o">(</span>NETDEV_UP<span class="o">)</span>: wlan0: link is not ready
Disconnected wifi_7cc70905cd77_4e5443_managed_psk
</code></pre>

<p>Generally, <code class="prettyprint">conman</code> will remember and cache setup information - if you reboot in the vicinity of a known network, it will attempt to connect. However, if you need to forget a network setup, these setups can be found by navigating:</p>
<pre class="highlight shell"><code>  <span class="nb">cd</span> /var/lib/connman/
</code></pre>

<p>You can delete a single connection by seeing what connections are stored</p>
<pre class="highlight shell"><code>  ls /var/lib/connman/
</code></pre>

<p>and then delete a setup that you find, for example</p>
<pre class="highlight shell"><code>  rm -r wifi_7cc70905cd77_4e5443_managed_psk
</code></pre>

<p>You can delete all the “wifi” directories with</p>
<pre class="highlight shell"><code>  rm -r wifi<span class="k">*</span>
</code></pre>

<p>(the -r is needed because these are directories you are deleting, and the wifi* assumes your configurations all start with the string “wifi”)</p>

<h2 id="for-advanced-users">For Advanced Users</h2>

<p>It&rsquo;s worth noting that you&rsquo;ll see two wireless networking interfaces if you list them with</p>
<pre class="highlight shell"><code>  ifconfig
</code></pre>

<p><code class="prettyprint">connman</code> is configured to see only the physical interface wlan0 which simplifies setup. We do this with a blacklist, which can be modified at <code class="prettyprint">/etc/connman/main.conf</code></p>

          <h1 id="connecting-c-h-i-p-to-wi-fi-with-nmcli">Connecting C.H.I.P. to Wi-Fi with nmcli</h1>

<p>There are several tools in Linux for connecting and configuring networks. We will be using the command nmcli (Network Manager Client). You may see other tutorials that reference iw or iwconfig, however, these tools are not recommended for C.H.I.P. You can read more about nmcli on the internet.</p>

<h2 id="requirements">Requirements</h2>

<p>You will need one of these scenarios:
  * CHIP with monitor and keyboard attached
  * <a href="Headless CHIP - ssh and serial">SSH or serial</a> connection
  * Wireless access to internet</p>

<h2 id="step-1-list-available-wi-fi-networks">Step 1: List available Wi-Fi networks</h2>

<p>In the terminal, type</p>
<pre class="highlight shell"><code>nmcli device wifi list
</code></pre>

<p>The output will list available access points</p>
<pre class="highlight shell"><code><span class="k">*</span>  SSID      MODE   CHAN  RATE       SIGNAL  BARS  SECURITY  
<span class="k">*</span>  NextThing HQ    Infra  11    54 Mbit/s  100     ▂▄▆█  --        
   NextThing Shop  Infra  6     54 Mbit/s  30      ▂___  WPA1 WPA2 
   2WIRE533        Infra  10    54 Mbit/s  44      ▂▄__  WPA1 WPA2 
</code></pre>

<h2 id="step-2-connect-to-a-network">Step 2: Connect to a network</h2>

<p>You can connect to password -protected or open access points.</p>

<h3 id="a-no-password">A: No Password</h3>

<p>To connect to an open network with no password, use this command:</p>
<pre class="highlight shell"><code>nmcli device wifi connect <span class="s1">'(your wifi network name/SSID)'</span> ifname wlan0
</code></pre>

<p>These commands will respond with information about the connection.</p>

<h3 id="b-password-protected">B: Password Protected</h3>

<p>To connect to a password protected network, use this command, inserting your own network name and password:</p>
<pre class="highlight shell"><code>nmcli device wifi connect <span class="s1">'(your wifi network name/SSID)'</span> password <span class="s1">'(your wifi password)'</span> ifname wlan0
</code></pre>

<h2 id="step-3-test-your-connection">Step 3: Test your Connection</h2>

<p>You can verify and test your wireless network connection.</p>

<h3 id="verify">Verify</h3>

<p>You can verify your connection using the command</p>
<pre class="highlight shell"><code>nmcli device status
</code></pre>

<p>which outputs a list of the various network devices and their connections. For example, a successful connection would look like this:</p>
<pre class="highlight shell"><code>DEVICE   TYPE      STATE         CONNECTION 
wlan0    wifi      connected     NextThing HQ   
wlan1    wifi      disconnected  --         
ip6tnl0  ip6tnl    unmanaged     --         
lo       loopback  unmanaged     --         
sit0     sit       unmanaged     --
</code></pre>

<p>Because it is worth knowing that Linux offers many ways of doing things, another command that shows your current active connection is
<code class="prettyprint">
nmcli connection show --active
</code></p>
<pre class="highlight shell"><code>NAME  UUID                                  TYPE             DEVICE 
NTC   59962bac-3441-437b-94ea-bf31dee66e8f  802-11-wireless  wlan0 
</code></pre>

<p>After you have connected once, your C.H.I.P. will automatically connect to this network next time you reboot (or start NetworkManager services).</p>

<h3 id="test">Test</h3>

<p>Finally, you can test your connection to the internet with <code class="prettyprint">ping</code>. Google&rsquo;s DNS server at the IP address 8.8.8.8 is probably the most reliable computer on the internet, so:</p>
<pre class="highlight shell"><code>ping -c 4 8.8.8.8
</code></pre>

<p>results in output like:</p>
<pre class="highlight shell"><code>64 bytes from 8.8.8.8: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>55 <span class="nb">time</span><span class="o">=</span>297 ms
64 bytes from 8.8.8.8: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>55 <span class="nb">time</span><span class="o">=</span>26.3 ms
64 bytes from 8.8.8.8: <span class="nv">icmp_seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>55 <span class="nb">time</span><span class="o">=</span>24.8 ms
64 bytes from 8.8.8.8: <span class="nv">icmp_seq</span><span class="o">=</span>4 <span class="nv">ttl</span><span class="o">=</span>55 <span class="nb">time</span><span class="o">=</span>55.7 ms
</code></pre>

<p>You can stop this command by pressing CTRL-C on your keyboard. The <code class="prettyprint">-c 4</code> option means it will happen only 4 times.</p>

<p>Congratulations! You are now network with C.H.I.P.!</p>

<h2 id="disconnecting-and-forgetting-networks">Disconnecting and Forgetting Networks</h2>

<p>The command to disconnect from a wireless device needs a few parameters:</p>
<pre class="highlight shell"><code>nmcli dev disconnect iface wlan0
</code></pre>

<p>You may want to prevent auto-connection to a network, so you can use this command to &ldquo;forget&rdquo; a network:</p>
<pre class="highlight shell"><code>nmcli connection delete id  <span class="o">(</span>your wifi network name/SSID<span class="o">)</span> 
</code></pre>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>Here are a few possible problems with connections.</p>

<h3 id="no-network-found">No network found</h3>

<p>Not much to say about that. If there&rsquo;s no network, you can&rsquo;t connect. Go find a network!</p>

<h3 id="incorrect-password">Incorrect password</h3>

<p>If you type in the wrong password, you&rsquo;ll get some errors like this:</p>
<pre class="highlight shell"><code><span class="o">[</span>32258.690000] RTL871X: rtw_set_802_11_connect<span class="o">(</span>wlan0<span class="o">)</span> <span class="nv">fw_state</span><span class="o">=</span>0x00000008
<span class="o">[</span>32258.800000] RTL871X: start auth
<span class="o">[</span>32263.720000] RTL871X: rtw_set_802_11_connect<span class="o">(</span>wlan0<span class="o">)</span> <span class="nv">fw_state</span><span class="o">=</span>0x00000008
<span class="o">[</span>32263.820000] RTL871X: start auth
<span class="o">[</span>32264.430000] RTL871X: auth success, start assoc
<span class="o">[</span>32269.850000] RTL871X: rtw_set_802_11_connect<span class="o">(</span>wlan0<span class="o">)</span> <span class="nv">fw_state</span><span class="o">=</span>0x00000008
<span class="o">[</span>32269.970000] RTL871X: start auth
Error: Timeout 90 sec expired.
</code></pre>

<p>Try connecting again with the correct password.</p>

<h3 id="failed-ping">Failed ping</h3>

<p>If you don&rsquo;t have access to the internet, your ping to an outside IP will fail. 
It is possible that you can connect to a wireless network, but have no access to the internet, so you&rsquo;d see a connection when you request device status, but have a failed ping. This indicates a problem or restriction with the router or the access point, not a problem with the C.H.I.P.</p>

<p>A failed ping looks something like:</p>
<pre class="highlight shell"><code>From 192.168.2.56 <span class="nv">icmp_seq</span><span class="o">=</span>14 Destination Host Unreachable
From 192.168.2.56 <span class="nv">icmp_seq</span><span class="o">=</span>15 Destination Host Unreachable
From 192.168.2.56 <span class="nv">icmp_seq</span><span class="o">=</span>16 Destination Host Unreachable
18 packets transmitted, 0 received, +9 errors, 100% packet loss, <span class="nb">time </span>17013ms
pipe 4
</code></pre>

<h3 id="loss-of-wireless-network">Loss of wireless network</h3>

<p>A sudden, unplanned disconnection will post an error in the terminal window, for example:</p>
<pre class="highlight shell"><code><span class="o">[</span>30863.880000] RTL871X: linked_status_chk<span class="o">(</span>wlan0<span class="o">)</span> disconnect or roaming
</code></pre>

<p>The Network Manager will periodically try to reconnect. If the access point is restored, you&rsquo;ll get something like this in your terminal window:</p>
<pre class="highlight shell"><code><span class="o">[</span>31798.970000] RTL871X: rtw_set_802_11_connect<span class="o">(</span>wlan0<span class="o">)</span>
<span class="o">[</span>31799.030000] RTL871X: start auth
<span class="o">[</span>31799.040000] RTL871X: auth success, start assoc
<span class="o">[</span>31799.050000] RTL871X: rtw_cfg80211_indicate_connect<span class="o">(</span>wlan0<span class="o">)</span> BSS not found !!
<span class="o">[</span>31799.060000] RTL871X: assoc success
</code></pre>

<h3 id="nmcli-not-installed-error">nmcli not installed error</h3>

<p>If you try to use <code class="prettyprint">nmcli</code> and you get an error that it is not found or is not a command, chances are that you are using the CHIP buildroot image. The <code class="prettyprint">nmcli</code> commands only apply to CHIPs running debian linux.</p>

          <h1 id="installing-zero-configuration-networking">Installing Zero Configuration Networking</h1>

<p>You can make working with CHIP on a local network much more convenient by installing zero-conf networking. OS X users may know this as “Bonjour”.</p>

<p>With zero-conf properly configured, your CHIP can be contacted using a name, such as <code class="prettyprint">chip.local</code>, rather than an IP. This is especially convenient, if you are moving CHIP to different networks that might assign different IP addresses. The key technology for this in Linux is the <code class="prettyprint">avahi</code> set of tools. There are a few related packages, but this tutorial is a minimal installation to get it up and running.</p>

<h2 id="requirements">Requirements</h2>

<ul>
<li>CHIP</li>
<li><a href="Headless CHIP - ssh and serial">SSH or serial connection to CHIP</a> or</li>
<li>Monitor and keyboard</li>
<li><a href="Connect To A Wireless Network with nmcli">Connection to the internet</a></li>
</ul>

<h2 id="install-avahi">Install avahi</h2>

<p>Getting avahi running is extremely simple. First, install the avahi-daemon:</p>
<pre class="highlight shell"><code>  apt-get install avahi-daemon
</code></pre>

<p>to install the necessary libraries. To configure the daemon, you&rsquo;ll probably need to add this service file:</p>
<pre class="highlight shell"><code>  nano /etc/avahi/services/afpd.service
</code></pre>

<p>Then just copy and paste this XML into it:</p>
<pre class="highlight shell"><code>&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">standalone</span><span class="o">=</span><span class="s1">'no'</span>?&gt;&lt;!--<span class="k">*</span>-nxml-<span class="k">*</span>--&gt;
&lt;!DOCTYPE service-group SYSTEM <span class="s2">"avahi-service.dtd"</span>&gt;
&lt;service-group&gt;
&lt;name replace-wildcards<span class="o">=</span><span class="s2">"yes"</span>&gt;%h&lt;/name&gt;
&lt;service&gt;
&lt;<span class="nb">type</span>&gt;_afpovertcp._tcp&lt;/type&gt;
&lt;port&gt;548&lt;/port&gt;
&lt;/service&gt;
&lt;/service-group&gt;
</code></pre>

<p>Then restart avahi-daemon:</p>
<pre class="highlight shell"><code>  /etc/init.d/avahi-daemon restart
</code></pre>

<p>You can now find the hostname that you can use to reach CHIP:</p>
<pre class="highlight shell"><code>  hostname
</code></pre>

<p>which will probably return “chip” as the hostname.</p>

<h2 id="use-zero-conf">Use Zero-Conf</h2>

<p>From a terminal on another computer you can try accessing CHIP with the network name <code class="prettyprint">chip.local</code></p>
<pre class="highlight shell"><code>  ssh root@chip.local
</code></pre>

<p>and enter the password (default is <code class="prettyprint">chip</code>). That&rsquo;s it. You can now reach CHIP without knowing the IP.</p>

<h2 id="change-the-hostname">Change the hostname</h2>

<p>If you have more than one CHIP on the network, or you just want to change the name from “chip” to fit into your network name scheme, you can modify the hostnames file. Open the file in an editor:</p>
<pre class="highlight shell"><code>  nano /etc/hostname
</code></pre>

<p>where you&rsquo;ll see a single word “chip.” Just modify that line (for example, change it to “bobofettywap”) and save the file. For this name to broadcast over the network restart avahi-daemon:</p>
<pre class="highlight shell"><code>  /etc/init.d/avahi-daemon restart
</code></pre>

<p>You can now access chip with the new name:</p>
<pre class="highlight shell"><code>  ssh root@bobofettywap.local 
</code></pre>

<h2 id="other-packages">Other packages</h2>

<p>You may want to explore some of the other features of avahi, such as browsing a network for other zero-configure enabled computers. There&rsquo;s a package you can install:</p>
<pre class="highlight shell"><code>  apt-get install avahi-utils
</code></pre>

<p>which gives you a set of tools for browsing the network, such as the command</p>
<pre class="highlight shell"><code>  avahi-browse
</code></pre>

<p>An alternative to just installing the avahi-daemon, you can</p>
<pre class="highlight shell"><code>  apt-get install libnss-mdns
</code></pre>

<p>which installs some other tools for network name propagation.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>If your computer returns the error</p>
<pre class="highlight shell"><code>  ssh: Could not resolve hostname chip.local: nodename nor servname provided, or not known
</code></pre>

<p>then you either need to wait a minute or try installing avahi-daemon again, but pay closer attention to any errors that apt-get returns.</p>

<p>If you can&rsquo;t connect to CHIP even though you are sure avahi is properly configured, confirm that your CHIP and the computer you are trying to connect are on the same local network (and on the same subnet).</p>

          <h2 id="connecting-bluetooth-devices">Connecting Bluetooth Devices</h2>

<p>CHIP has built-in bluetooth. This tutorial instructs how to use a bluetooth keyboard, since it is a simple and obvious example. There are, of course, several types of bluetooth devices, such as earpieces, audio connectors, vacuum cleaners, and more. Future tutorials will cover those devices, but the keyboard is a good introduction to the commands and an easy way to test your system.</p>

<h2 id="requirements">Requirements</h2>

<ul>
<li>CHIP</li>
<li>SSH or serial connection to CHIP or</li>
<li>Monitor and keyboard</li>
<li>Bluetooth device, preferably keyboard</li>
</ul>

<h2 id="important">Important!</h2>

<p>Start with a CHIP completely unplugged and powered down. Add power and boot up. A known limitation is that after <code class="prettyprint">reboot</code>, CHIP&rsquo;s Bluetooth controller may not work until you <code class="prettyprint">power</code> and physically disconnect from a power source.</p>

<h2 id="about-bluetoothctl">About <code class="prettyprint">bluetoothctl</code></h2>

<p>We&rsquo;ll be using the command <code class="prettyprint">bluetoothctl</code> to find, pair with, and connect to devices.</p>

<p>Type
<code class="prettyprint">shell
  bluetoothctl
</code></p>

<p>in the command line. This starts up <code class="prettyprint">bluetoothctl</code> in interactive mode. You should see output like</p>
<pre class="highlight shell"><code><span class="o">[</span>NEW] Controller 7C:C7:08:05:CD:77 BlueZ 5.27 <span class="o">[</span>default]
<span class="o">[</span>NEW] Device 60:33:4B:13:A7:45 nyb
<span class="o">[</span>NEW] Device 15:03:26:A0:26:26 SK032B02-2626
</code></pre>

<p>which is a list of MAC addresses of CHIP&rsquo;s bluetooth controller chip (the first line) and any other devices that have been paired with CHIP in the past. Use the</p>
<pre class="highlight shell"><code>  <span class="nb">help</span>
</code></pre>

<p>command - it lists all the very useful commands in the <code class="prettyprint">bluetoothctl</code> interactive mode.</p>

<p>In bluetooth interactive mode, use the command
<code class="prettyprint">shell
  power on
</code></p>

<p>which outputs</p>
<pre class="highlight shell"><code>Changing power on succeeded
<span class="o">[</span>CHG] Controller 7C:C7:08:05:CD:77 Powered: yes
</code></pre>

<h2 id="find-a-bluetooth-device">Find A Bluetooth Device</h2>

<p>If you need to discover a device, start the scan process:</p>
<pre class="highlight shell"><code>  scan on
</code></pre>

<p>which will start printing MAC addresses and names (if available) of bluetooth devices in your vicinity.</p>
<pre class="highlight shell"><code><span class="o">[</span>NEW] Device 15:03:26:A0:26:26 SK032B02-2626
<span class="o">[</span>NEW] Device 1C:1A:C0:85:5E:2C 1C-1A-C0-85-5E-2C
<span class="o">[</span>NEW] Device 60:33:4B:13:A7:45 nyb
</code></pre>

<h2 id="pair-with-a-bluetooth-device">Pair With A Bluetooth Device</h2>

<p>Pair to a device with the MAC address and the <code class="prettyprint">pair</code> command:</p>
<pre class="highlight shell"><code>  pair 1C:1A:C0:85:5E:2C
</code></pre>

<p>This may fail if the device is powered off, goes out of range, or your toddler spills water on it. Here&rsquo;s what failure looks like:</p>
<pre class="highlight shell"><code>Attempting to pair with 1C:1A:C0:85:5E:2C 
<span class="o">[</span>CHG] Device 1C:1A:C0:85:5E:2C Connected: yes 
<span class="o">[</span>CHG] Device 1C:1A:C0:85:5E:2C Connected: no 
Failed to pair: org.bluez.Error.AuthenticationCanceled
</code></pre>

<p>As the scan continues, you&rsquo;ll eventually see the device you are interested in, so copy that MAC address and type:</p>
<pre class="highlight shell"><code>  pair 15:03:26:A0:26:26
</code></pre>

<p>with output like:</p>
<pre class="highlight shell"><code><span class="o">[</span>CHG] Device 15:03:26:A0:26:26 Connected: yes
<span class="o">[</span>CHG] Device 15:03:26:A0:26:26 Modalias: usb:v05ACp3232d0001
<span class="o">[</span>CHG] Device 15:03:26:A0:26:26 UUIDs:
 00001124-0000-1000-8000-00805f9b34fb
 00001200-0000-1000-8000-00805f9b34fb
<span class="o">[</span>CHG] Device 15:03:26:A0:26:26 Paired: yes
Pairing successful
<span class="o">[</span>CHG] Device 15:03:26:A0:26:26 Connected: no
Pair with a Bluetooth Device with Password <span class="o">(</span>keyboard<span class="o">)</span>
</code></pre>

<p>Some Bluetooth devices need user input to pair. In that case, you&rsquo;ll need to turn the agent &lsquo;on&rsquo; so the device can post a password, and you can enter it:</p>
<pre class="highlight shell"><code>  agent on
</code></pre>

<p>will output</p>
<pre class="highlight shell"><code>  Agent registered
</code></pre>

<p>now you can pair it:</p>
<pre class="highlight shell"><code>  pair DC:2C:26:D7:B6:8F
</code></pre>

<p>will output</p>
<pre class="highlight shell"><code>Attempting to pair with DC:2C:26:D7:B6:8F
<span class="o">[</span>CHG] Device DC:2C:26:D7:B6:8F Connected: yes
<span class="o">[</span>agent] PIN code: 245261
</code></pre>

<p>Now you can use the bluetooth device to enter the PIN code, then hit enter. The terminal will give some status about the pairing:</p>
<pre class="highlight shell"><code><span class="o">[</span>CHG] Device DC:2C:26:D7:B6:8F Modalias: usb:v05ACp022Cd011B
<span class="o">[</span>CHG] Device DC:2C:26:D7:B6:8F UUIDs:
        00001000-0000-1000-8000-00805f9b34fb
        00001124-0000-1000-8000-00805f9b34fb
        00001200-0000-1000-8000-00805f9b34fb
<span class="o">[</span>CHG] Device DC:2C:26:D7:B6:8F Paired: yes
Pairing successful
<span class="o">[</span>CHG] Device DC:2C:26:D7:B6:8F Connected: no
</code></pre>

<p>Now that you are paired, you will have to connect.</p>

<h2 id="connect-with-a-bluetooth-device">Connect With A Bluetooth Device</h2>

<p>Now that you have paired the bluetooth device, you won&rsquo;t have to do that again. However, the device still needs to be connected:</p>
<pre class="highlight shell"><code>  connect 15:03:26:A0:26:26
</code></pre>

<p>will output, when successful:</p>
<pre class="highlight shell"><code>Attempting to connect to 15:03:26:A0:26:26
<span class="o">[</span>CHG] Device 15:03:26:A0:26:26 Connected: yes
Connection successful
<span class="gp">[bluetooth]## </span><span class="o">[</span> 1405.340000] hid-generic 0005:05AC:3232.0001: unknown main item tag 0x0
<span class="o">[</span> 1405.360000] input: SK032B02-2626 as /devices/platform/soc@01c00000/1c28c00.serial/tty/ttyS1/hci0/hci0:4/0005:05AC:3232.0001/input/input1
<span class="o">[</span> 1405.380000] hid-generic 0005:05AC:3232.0001: input: BLUETOOTH HID v0.01 Mouse <span class="o">[</span>SK032B02-2626] on 7c:c7:08:05:cd:77
</code></pre>

<p>or, if the device is not available, it will fail:</p>
<pre class="highlight shell"><code>Attempting to connect to 15:03:26:A0:26:26
<span class="gp">[bluetooth]## </span><span class="o">[</span> 1304.470000] Bluetooth: HIDP <span class="o">(</span>Human Interface Emulation<span class="o">)</span> ver 1.2
<span class="o">[</span> 1304.480000] Bluetooth: HIDP socket layer initialized
Failed to connect: org.bluez.Error.Failed
</code></pre>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>If your bluetooth controller module on CHIP is not functioning, you can easily find the problem. Type</p>
<pre class="highlight shell"><code>  bluetoothctl
</code></pre>

<p>to get into the interactive mode, then type</p>
<pre class="highlight shell"><code>  power on
</code></pre>

<p>If you get the response</p>
<pre class="highlight shell"><code>  No default controller available
</code></pre>

<p>Then there&rsquo;s a problem with CHIP recognizing the bluetooth module. <a href="#Important">Read the very first instructions</a> at the top of this tutorial.</p>

<p>If you connect a bluetooth keyboard, you may not see keyboard output in the monitor. However, if all the messages from <code class="prettyprint">bluetoothctl</code> indicated success, the problem is a configuration issue with CHIP, not a bluetooth issue.</p>

          <h1 id="headless-chip-ssh-and-serial-control">Headless CHIP: SSH and Serial Control</h1>

<p>If you want to use CHIP without a monitor or keyboard attached, there&rsquo;s a few ways to do this:</p>

<ul>
<li>Serial connection with USB to UART cable</li>
<li>Serial connection with USB cable</li>
<li>Secure Shell (SSH) over wireless or wired ethernet</li>
</ul>

<h2 id="requirements">Requirements</h2>

<ul>
<li>Computer running OS X 10.10+, Ubuntu 14.04+, or Windows 7+</li>
<li>CHIP</li>
<li>Monitor and keyboard (somewhat optional, though handy)</li>
<li><a href="Connect To A Wireless Network with nmcli">Connection to the internet</a></li>
</ul>

<h2 id="ssh">SSH</h2>

<p>SSH (or &ldquo;Secure Shell&rdquo;) is a common way to control a computer remotely over a network. You&rsquo;ll need to first get your computer&rsquo;s network name or IP address before you can connect.</p>

<h3 id="how-to-get-your-ip-address">How to get your IP address.</h3>

<p>The easiest way to get CHIPs IP address is to hook up a monitor and keyboard. Bootup, log in, <a href="Connect To A Wireless Network">connect to the network</a> if you need to, and use the command</p>
<pre class="highlight shell"><code>hostname -i
</code></pre>

<p>which results in your IP address, which might look like this:</p>
<pre class="highlight shell"><code>10.1.1.99
</code></pre>

<p>If the <code class="prettyprint">hostname -i</code> command doesn&rsquo;t work you can use</p>
<pre class="highlight shell"><code>ip addr show dev wlan0
</code></pre>

<p>which will output a lot of data. Look for the line <code class="prettyprint">wlan0</code> and the entry <code class="prettyprint">inet</code>, something like:</p>
<pre class="highlight shell"><code>inet 10.1.1.99
</code></pre>

<h3 id="connect-to-chip-over-a-network">Connect to CHIP over a network</h3>

<p>Now that you know your IP address, use the command:</p>
<pre class="highlight shell"><code>ssh root@10.1.1.99
</code></pre>

<p>You&rsquo;ll be asked for CHIP&rsquo;s password. The default password is <code class="prettyprint">chip</code>.
This process is the same if CHIP is connected to the network using built-in wireless or a USB-Ethernet adapter.</p>

<h3 id="make-connections-easy">Make Connections Easy</h3>

<p>You may want to setup your network so it will always provide the same (static) IP address to CHIP. You can then rely on CHIP always having the same IP address. </p>

<p>Alternatively, you can <a href="Zero Configuration Networking">setup zero configuration networking</a> to give your CHIP an easily remembered name. </p>

<p>You are now free to do whatever it is you do with Linux command line on CHIP.</p>

<h2 id="usb-to-uart-serial-connection">USB to UART Serial Connection</h2>

<p>There are a few reasons you&rsquo;d want to use a serial connection:</p>

<ul>
<li>No wireless network</li>
<li>No USB-ethernet cable</li>
<li>Don&rsquo;t know the IP or network name of CHIP</li>
<li>You&rsquo;re old-school and like it</li>
</ul>

<p>Connect a USB to UART cable to the Ground (GND), Transmit (TX), and Recieve (RX) pins on C.H.I.P.</p>

<p>We&rsquo;ll find those on header U14, pin outs 1,3 and 5.
See the following diagram, which assumes C.H.I.P.&rsquo;s USB ports are pointed up&hellip;</p>

<p><img alt="Pinout diagram for CHIP" src="images/wiki:chip_alpha_v02_pinouts.png?500" /></p>

<h3 id="about-the-cable">About the Cable</h3>

<p>If you need a connector, search your favorite shop for &lsquo;USB to UART cable&rsquo; - any will do.</p>

<p>Here&rsquo;s the <a href="http://www.amazon.com/Armorview-PL2303HX-RS232-Module-Converter/dp/B008AGDTA4">one we bought</a>. Most of them will have a USB A plug for your computer on one end and four wires (red, green, black, and white) with female header pins on the other.</p>

<p>You may find other USB-UART cables that have more wires. There will be some labels that will help you connect to the correct pins (GND, TX, RX) on terminal U14. Take a look at this example of a <a href="http://www.newegg.com/Product/Product.aspx?Item=9SIA86V2Z33892&amp;nm_mc=KNC-GoogleMKP-PC&amp;cm_mmc=KNC-GoogleMKP-PC-_-pla-_-Gadgets-_-9SIA86V2Z33892&amp;gclid=CjwKEAiApYGyBRC-g_jIstuduV8SJABCEzhZMxn2i7ZmCxk47Jt730KDjUlUfmmJIyvQlkDFRFcGfxoCuJPw_wcB&amp;gclsrc=aw.ds">CP2102 UART converter</a>.
Just be sure to check your datasheets to make sure you&rsquo;re using the correct pins.</p>

<h3 id="install-the-driver">Install the driver</h3>

<p>For this tutorial, we are using a PL2303 USB to Serial cable. You&rsquo;ll most likely need to <a href="http://www.prolific.com.tw/US/ShowProduct.aspx?pcid=41&amp;showlevel=0041-0041">install the PL2303 driver</a> for your computer.</p>

<h3 id="connect-the-cable">Connect the Cable</h3>

<p>You only need to worry about three of the wires:</p>

<ul>
<li>Black = Ground (GND)</li>
<li>White = Transmit (TX)</li>
<li>Green = Receive (RX)</li>
</ul>

<p>The red wire carries voltage (+5 V).
DO NOT USE THE RED ONE.
Plugging in a +5 V pin could damage your C.H.I.P.</p>

<p>Again, there is a chance your USB to UART cable may be different.
Please check your data sheets!</p>

<p>This is what our cable looks like plugged in:</p>

<p><img alt="Properly connect USB to UART cable" src="images/wiki:uart_connection.jpg?500" /></p>

<h2 id="usb-on-the-go-serial-connection">USB On The Go Serial Connection</h2>

<p>Simpler than the UART cable, you can connect to CHIP with a USB cable to your computer. Your computer will see CHIP as a serial device as well as provide power to the CHIP. Either way, you&rsquo;ll be able to continue with the directions below.</p>

<h1 id="control-chip-using-a-serial-terminal">Control CHIP Using a Serial Terminal</h1>

<p>Once you&rsquo;ve connected C.H.I.P. to your computer with the UART or USB cable, open up a terminal. There&rsquo;s lots out there. Here&rsquo;s a few:
  * OS X: <a href="http://www.dalverson.com/zterm/">Zterm</a>, <code class="prettyprint">screen</code> (built-in to OS X terminal)
  * Windows: <a href="http://www.chipkin.com/using-putty-for-serial-com-connections-hyperterminal-replacement/">PuTTy</a>
  * Linux: <code class="prettyprint">screen</code>, <code class="prettyprint">cu</code>
No matter the software, you&rsquo;ll need to set some settings for the port (aka connection). You&rsquo;ll probably only need to set the baud rate, as the others will be defaults:</p>

<ul>
<li>Baud Rate (Data Rate): 115200</li>
<li>Data Bits: 8</li>
<li>Parity: none</li>
<li>Stop bits: 1</li>
<li>Flow control: none</li>
</ul>

<p>If you are using screen, the command will look something like this:</p>
<pre class="highlight shell"><code>screen /dev/tty.usbserial 115200
</code></pre>

<p>or</p>
<pre class="highlight shell"><code>screen /dev/ttyUSB0 115200
</code></pre>

<p>What comes after the &rsquo;/dev/&rsquo; may vary among different systems and connections. You can narrow down the choices by using the command</p>
<pre class="highlight shell"><code>ls /dev/tty<span class="k">*</span>
</code></pre>

<p>to list the serial devices. </p>

<p>Now power up CHIP. You could do this at anytime, but you&rsquo;ll have the most reliable experience powering CHIP after connecting the USB-UART wires. If you make the serial connection after booting chip, you&rsquo;ll probably need to hit &#39;return&rsquo; on your keyboard a few times to get CHIP to send some data to you and print in your terminal.</p>

<p>You&rsquo;ll then be prompted for login. Defaults are username <code class="prettyprint">root</code> and password <code class="prettyprint">chip</code>.</p>

<p>You are now free to do whatever it is you do with Linux command line on CHIP.</p>

          <h1 id="simple-gpio-experiments">Simple GPIO Experiments</h1>

<p>CHIP has several General Purpose Input/Output (GPIO) pins available for you to build around. If you want to access them in a very primitive way, just to confirm their existence, here&rsquo;s some things to try.</p>

<h2 id="requirements">Requirements</h2>

<ul>
<li>CHIP</li>
<li>Jumper Wire</li>
<li>SSH or serial connection to CHIP or</li>
<li>Monitor and keyboard</li>
</ul>

<h2 id="how-you-see-gpio">How You See GPIO</h2>

<p>There are eight (8) GPIO pins always available for connecting CHIP to the sense-able world. These are in the middle of the right header, U14, Pins 13-20, labeled XIO-P0 to P7: </p>

<p><img alt="Pinout diagram for CHIP" src="images/wiki:chip_alpha_v02_pinouts.png?500" /></p>

<h2 id="how-the-system-sees-gpio">How The System Sees GPIO</h2>

<p>There is a sysfs interface available for the GPIO. This just means you can access the GPIO states in a file-system-like manner. For example, you can reference XIO-P0 using this path:</p>
<pre class="highlight shell"><code>  /sys/class/gpio/gpio408/
</code></pre>

<p>The number is somewhat unfortunate, since the <code class="prettyprint">sysfs</code> names do not match the labels on our diagram! But is not too hard to translate. PinsXIO-P0 to P7 linearly map to gpio408 to gpio415.</p>

<h2 id="some-gpio-switch-action">Some GPIO Switch Action</h2>

<p>These lines of code will let us read values on pin XIO-P7. First, we tell the system we want to listen to this pin:</p>
<pre class="highlight shell"><code>  <span class="nb">echo </span>415 &gt; /sys/class/gpio/export
</code></pre>

<p>View the mode of the pin. It should return “in”:</p>
<pre class="highlight shell"><code>  cat /sys/class/gpio/gpio415/direction
</code></pre>

<p>Connect a jumper wire between Pin 20 (XIO-P7) and Pin 39 (GND). Now use this line of code to read the value:</p>
<pre class="highlight shell"><code>  cat /sys/class/gpio/gpio415/value
</code></pre>

<h2 id="some-gpio-output">Some GPIO Output</h2>

<p>You could also change the mode of a pin from “in” to “out”</p>
<pre class="highlight shell"><code>  <span class="nb">echo </span>out &gt; /sys/class/gpio/gpio415/direction
</code></pre>

<p>Now that it&rsquo;s in output mode, you can write a value to the pin:
<code class="prettyprint">shell
  echo 1 &gt; /sys/class/gpio/gpio415/value
</code></p>

<h2 id="enough-io">Enough IO</h2>

<p>When you are done experimenting, you can tell the system to stop listening to the gpio pin:
<code class="prettyprint">shell
  echo 415 &gt; /sys/class/gpio/unexport
</code></p>

<h2 id="learn-more">Learn More</h2>

<p>You can learn a bit more about GPIO and Linux <a href="https://www.kernel.org/doc/Documentation/gpio/sysfs.txt">here:</a></p>

          # Sound Output on Debian
Getting simple audio playback working on CHIP is pretty easy, once you install the correct packages and enable audio output. In the code examples below, we've inserted the && characters at the end of lines so you can copy and paste the entire block into a terminal window and execute each line in series.

## Requirements
  * CHIP
  * A [SSH or serial connection to CHIP](Headless CHIP - ssh and serial) or
  * Monitor and keyboard
  * Headphones or powered speakers connected to CHIP a/v jack
  * A [Connection to the internet](Connect To A Wireless Network with nmcli)

## Setup CHIP

Update your apt repository list if you haven't done so recently:

```shell
  apt-get update
```
  
Then install ALSA:

```shell
  apt-get install libasound2 alsa-utils
```

This will install alsa and some utilities for playing sound from the command line. Once those have installed, you'll need to make the outputs active for sound

```shell
  alsamixer
```

will open up a simple interface. Use the left and right arrow keys on your keyboard to select among the items, and use the up/down keys to change the options:

  * DAC Output - set to Direct
  * Left Mixer - set to Left
  * PA - set to desired volume
  * Right Mixer - set to Right

![alsamixer interface](wiki:alsamixer.png?400)

## Play a Sound

Change to the root media directory:

```shell
  cd /media
```

Alternatively, you could download a sound into chip's home directory:

```shell
  mkdir /home/chip/Media && cd /home/chip/Media
```

Use `wget` to download a sound of piano chords to the file test.wav:

```shell
  wget -O test.wav https://upload.wikimedia.org/wikipedia/commons/d/db/Descending_thirds.wav
```

If wget returns command not found you can install it:

```shell
  apt-get install wget
```

We can finally play the sound and hear it over CHIP's headphone jack:

```shell
  aplay test.wav
```

If you want to play mp3 or ogg files, you can install mplayer:

```shell
  apt-get install mplayer
```

Then try an ogg file:

```shell
  wget -O test.ogg https://upload.wikimedia.org/wikipedia/commons/e/e7/Agogo.ogg &&
  mplayer test.ogg
```

And mp3 file:

```shell
  wget -O test.mp3 http://www.freesound.org/data/previews/315/315618_2050105-lq.mp3 &&
  mplayer test.mp3
```

#Known Issue
As of the writing of this document, the sound on CHIP is not optimized. You'll notice that the pitch is shifted down, playing back at approximately 80% speed. This will be fixed in a future update.

#More Packages
Developers that want to use sound will probably want to download these packages:

```shell
apt-get install portaudio19-dev &&
apt-get install swig &&
apt-get install python-setup-tools &&
apt-get install python-dev
```

          <h2 id="usb-storage-devices">USB Storage Devices</h2>

<p>In this tutorial, we&rsquo;ll describe how you can use the USB port to add more storage with a thumb drive, hard drive, card reader, or whatever else. You can then copy, store, and edit files on the storage device, extending the capability of CHIP.</p>

<p>This tutorial is suitable for the buildroot image. If you are following this for other Linux distributions, there are some adjustments that you&rsquo;ll need to make for paths, permissions, and enabling &lsquo;sudo.&rsquo; With buildroot, you work as the root user, so this tutorial is appropriately terse.</p>

<h2 id="requirements">Requirements</h2>

<ul>
<li>USB thumb drive or hard drive</li>
<li>Computer running OS X 10.10+, Ubuntu 14.04+, or Windows 7+ (to format USB device, if needed)</li>
</ul>

<h2 id="step-1-format-the-drive">Step 1: Format the Drive</h2>

<p>First, you&rsquo;ll want to format the drive as an MS-DOS (FAT), NTFS, or ext3 volume. You can do this on another computer.</p>

<p>Once formatted, insert the drive into CHIP&rsquo;s USB port. Enter the command</p>
<pre class="highlight shell"><code>dmesg
</code></pre>

<p>You&rsquo;ll get output like:</p>
<pre class="highlight shell"><code><span class="o">[</span> 4953.430000] usb 1-1: new high-speed USB device number 2 using ehci-platform
<span class="o">[</span> 4953.580000] usb-storage 1-1:1.0: USB Mass Storage device detected
<span class="o">[</span> 4953.590000] scsi host0: usb-storage 1-1:1.0
<span class="o">[</span> 4954.590000] scsi 0:0:0:0: Direct-Access USB Flash Memory 1.00 PQ: 0 ANSI: 2
<span class="o">[</span> 4954.600000] sd 0:0:0:0: <span class="o">[</span>sda] 3911616 512-byte logical blocks: <span class="o">(</span>2.00 GB/1.86 GiB<span class="o">)</span>
<span class="o">[</span> 4954.610000] sd 0:0:0:0: <span class="o">[</span>sda] Write Protect is off
<span class="o">[</span> 4954.620000] sd 0:0:0:0: <span class="o">[</span>sda] Mode Sense: 65 44 09 30
<span class="o">[</span> 4954.630000] sd 0:0:0:0: <span class="o">[</span>sda] No Caching mode page found
<span class="o">[</span> 4954.630000] sd 0:0:0:0: <span class="o">[</span>sda] Assuming drive cache: write through
<span class="o">[</span> 4954.650000] sda: sda1
<span class="o">[</span> 4954.650000] sd 0:0:0:0: <span class="o">[</span>sda] Attached SCSI removable disk
</code></pre>

<p>Notice the second to last line. This tells you the device location for the drive. Storage devices generally have device names that start with “sd”, so if you wanted to see all the storage devices attached to CHIP, you can use a wildcard to display all devices that start with “sd”:</p>
<pre class="highlight shell"><code>ls /dev/sd<span class="k">*</span>
</code></pre>

<p>and you&rsquo;ll get something like:</p>
<pre class="highlight shell"><code>/dev/sda /dev/sda1
</code></pre>

<p>With one thumb drive attached, it appears as two devices: the device itself (sda), and the storage partitions (sda1). There is only one partition on this drive.</p>

<p>Another way to find storage devices is the command</p>
<pre class="highlight shell"><code>blkid
</code></pre>

<p>which lists them, along with the names you might have initialized them with:</p>
<pre class="highlight shell"><code>/dev/sda1: <span class="nv">LABEL</span><span class="o">=</span><span class="s2">"TEST"</span> <span class="nv">UUID</span><span class="o">=</span><span class="s2">"6668-11E9"</span>
</code></pre>

<h2 id="step-2-mount-the-drive-device-to-your-filesystem">Step 2: Mount the Drive Device to Your Filesystem</h2>

<p>Now that you know where your partition is, it&rsquo;s time to mount the partition so you can access the files. </p>

<p>First, make a directory where your drive can mount:</p>
<pre class="highlight shell"><code>mkdir /drives
</code></pre>

<p>Mount the drive device to your /drives directory:</p>
<pre class="highlight shell"><code>mount /dev/sda1 /drives
</code></pre>

<p>Now you can navigate to the <code class="prettyprint">drives</code> directory and see all the files in the drive:</p>
<pre class="highlight shell"><code><span class="nb">cd</span> /drives
ls
</code></pre>

<h2 id="step-3-unmount-the-drive-from-filesystem">Step 3: Unmount the Drive From Filesystem</h2>

<p>If you want to remove the drive from the USB port on CHIP, it&rsquo;s best to unmount it:</p>
<pre class="highlight shell"><code>umount /dev/sda1
</code></pre>

<h2 id="step-4-automatic-mounting-on-boot">Step 4: Automatic Mounting on Boot</h2>

<p>You&rsquo;ll probably want to mount this drive automatically next time you use it, though. We can set that up with a quick modification to the <code class="prettyprint">fstab</code> (file system table) document:</p>
<pre class="highlight shell"><code>vi /etc/fstab
</code></pre>

<p>Getting around vi is not very intutive, so if you are new to it, here&rsquo;s a quick guide on getting this text into fstab: 
  * &#39;arrow&rsquo; key to the end of the file,
  * press the &#39;i&rsquo; key to insert text
  * type (or copy-paste) this:</p>
<pre class="highlight shell"><code>/dev/sda1 /drives vfat defaults 0 0
</code></pre>

<p>To exit vi, 
  * press the &#39;esc&rsquo; key, 
  * type &rsquo;:&rsquo; (colon), 
  * type &#39;wq&rsquo; to write and quit vi.</p>

<p>You can test your work with:</p>
<pre class="highlight shell"><code>mount -a
</code></pre>

<p>If there&rsquo;s an error, double check the <code class="prettyprint">fstab</code> file and make sure it has the line <code class="prettyprint">/dev/sda1 /drives vfat defaults 0 0</code> at the end. If it&rsquo;s successful, you&rsquo;ll be able to view, modify and copy the files on the disk:</p>
<pre class="highlight shell"><code>ls /drives
</code></pre>

<p>Now, if you reboot , the drive will mount automatically. If you remove the drive, then insert it again, you&rsquo;ll need the command</p>
<pre class="highlight shell"><code>mount -a
</code></pre>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
                <a href="#" data-language-name="python">python</a>
          </div>
      </div>
    </div>
  </body>
</html>
